@go.Package { name = "github.com/47monad/sercon/go-gen/svcconf" }
@ModuleInfo { minPklVersion = "0.26.0" }
module o47monad.sercon.ServiceConfig

import "package://pkg.pkl-lang.org/pkl-go/pkl.golang@0.8.0#/go.pkl"
import "./Common.pkl"
import "./db/MongodbConfig.pkl"
import "./monitoring/PrometheusConfig.pkl"
import "./log/LogConfig.pkl"
import "./GrpcConfig.pkl"

name: String = ""
version: String = ""

ports: Mapping<String, Common.Port> = new Mapping<String, Common.Port> {
  ["port"] = read?("env:PORT")?.toInt() ?? 4746
  ["grpc"] = read?("env:GRPC_PORT")?.toInt() ?? 4747
  ["http"] = read?("env:HTTP_PORT")?.toInt() ?? 4749
}

host: String = "127.0.0.1"

env: String = read?("env:ENV") ?? "production"

debugMode: Boolean = read?("env:DEBUG_MODE")?.toBoolean() ?? false

log: LogConfig = new LogConfig {
  level = let (lvl = read?("env:LOG_LEVEL")?.toString() ?? "error") lvl as LogConfig.Level
}

grpc: GrpcConfig? = new GrpcConfig {
  port = read?("env:GRPC_PORT")?.toInt() ?? 4747
  useHealthCheck = read?("env:GRPC_USE_HEALTH_CHECK")?.toBoolean() ?? true
  useReflection = read?("env:GRPC_USE_REFLECTION")?.toBoolean() ?? false
  useLogging = read?("env:GRPC_USE_LOGGING")?.toBoolean() ?? true
}

mongodb: MongodbConfig? = new MongodbConfig {
  enabled = false
  uri = read?("env:MONGO_URI")
  dbName = read?("env:MONGO_DB").toString()
}

prometheus: PrometheusConfig = new PrometheusConfig {
  enabled = false
  useGrpcMetrics = false
}
